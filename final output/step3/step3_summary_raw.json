{"meta":{"script":"step3_train_and_backtest.py","script_version":"2.4.0","generated_utc":"2026-02-17T18:35:10.095541+00:00","train_lookback_days":1460,"embargo_days":10,"min_train_events":220,"min_val_events":45,"min_test_events":6,"mix_struct_weight":0.55,"policy_profile":"growth","max_aggressive_size":1.35,"portfolio_allocator":"dynamic_regime","portfolio_objective":"end_equity","portfolio_train_ratio":0.55,"portfolio_weight_step":0.05,"portfolio_lookback_days":504,"portfolio_min_train_days":252,"portfolio_turnover_penalty":0.04,"portfolio_weight_smoothing":0.15,"portfolio_momentum_days":63,"portfolio_vol_days":21,"portfolio_vol_penalty":1.4,"portfolio_max_tilt":0.2,"portfolio_min_weight":0.25,"portfolio_max_weight":0.98,"portfolio_spy_guard_enabled":true,"portfolio_spy_guard_lookback_days":63,"portfolio_spy_guard_drift_lookback_days":42,"portfolio_spy_guard_min_mult":0.25,"portfolio_spy_guard_dd_penalty":1.2,"spy_drift_kill_switch":"soft","spy_drift_feature_z_cap":1.25,"drought_relief_enable":true,"drought_relief_symbol":"QQQ","drought_target_trades_per_month":5.5,"drought_p_cut_relax":0.015,"drought_ev_relax":0.00018,"drought_size_boost":0.08,"pattern_aid_enable":true,"pattern_n_clusters":6,"pattern_min_cluster_samples":40,"pattern_prior_strength":120.0,"pattern_consistency_tol":0.004,"pattern_prob_strength":0.55,"pattern_ret_strength":0.65,"pattern_prob_max_abs_delta":0.04,"pattern_ret_max_abs_delta":0.0035,"cost_stress_multipliers":[1.25,1.5],"bootstrap_samples":800,"bootstrap_block_months":6,"bootstrap_seed":42,"retune_every_folds":2,"model_stack":"LightGBM classifier/regressor/quantiles + ridge ensemble + calibrated probabilities + confidence sizing + cross-asset pattern context aid","note":"Nested walk-forward tuning with purge+embargo, drift-aware safety guard, monthly out-of-sample testing, and pattern context aid."},"symbol_summaries":{"qqq":{"symbol":"QQQ","n_folds":73,"n_scored_events":806,"n_trades":345,"aggressive_rate":0.562319,"fold_stability":{"median_test_calmar":15.07719,"p25_test_calmar":-2.359116,"negative_test_calmar_rate":0.520548,"median_test_trades":5.0,"drift_trigger_rate":0.164384,"pattern_active_rate":0.958904,"pattern_mean_abs_prob_delta":0.003622,"pattern_mean_abs_ret_delta":0.000126},"perf":{"n":345,"end_equity":22536.938218,"cagr":0.109031,"max_drawdown":0.080039,"calmar":1.362226,"net_bps_mean":23.55277,"aggressive_rate":0.562319,"trades_per_month":3.661822}},"spy":{"symbol":"SPY","n_folds":79,"n_scored_events":891,"n_trades":308,"aggressive_rate":0.402597,"fold_stability":{"median_test_calmar":0.092565,"p25_test_calmar":-5.923182,"negative_test_calmar_rate":0.708861,"median_test_trades":4.0,"drift_trigger_rate":0.379747,"pattern_active_rate":0.949367,"pattern_mean_abs_prob_delta":0.004507,"pattern_mean_abs_ret_delta":6.6e-05},"perf":{"n":308,"end_equity":13442.538743,"cagr":0.038992,"max_drawdown":0.050016,"calmar":0.77959,"net_bps_mean":9.605166,"aggressive_rate":0.402597,"trades_per_month":3.318915}}},"portfolio":{"dual_perf":{"start_time_utc":"2017-12-01 00:00:00+00:00","end_time_utc":"2025-12-24 00:00:00+00:00","end_equity":22190.932848,"cagr":0.103911,"max_drawdown":0.078153,"calmar":1.329584,"n_days":2946},"qqq_standalone_perf":{"start_time_utc":"2017-12-01 00:00:00+00:00","end_time_utc":"2025-12-24 00:00:00+00:00","end_equity":22536.938218,"cagr":0.106031,"max_drawdown":0.080039,"calmar":1.324745,"n_days":2946},"spy_standalone_perf":{"start_time_utc":"2017-12-01 00:00:00+00:00","end_time_utc":"2025-12-24 00:00:00+00:00","end_equity":13442.538743,"cagr":0.037373,"max_drawdown":0.050016,"calmar":0.747204,"n_days":2946},"allocator":{"selected":"static_train_optimized","holdout_split_index":1620,"holdout_start_utc":"2022-05-09 00:00:00+00:00","holdout_score_static":1.124034,"holdout_score_dynamic":1.053924,"qqq_weight_mean":0.971177,"qqq_weight_min":0.958118,"qqq_weight_max":0.985044,"qqq_weight_turnover_abs":0.834697,"spy_weight_mean_pre_guard":0.05,"spy_guard_mean":0.576468,"spy_guard_min":0.29911,"spy_guard_max":0.83764},"avg_monthly_pnl":125.67972,"median_monthly_pnl":38.839503,"avg_monthly_trades":6.731959,"monthly_positive_rate":0.536082,"monthly_negative_rate":0.329897,"top5_positive_pnl_share":0.283261,"zero_trade_month_rate":0.134021,"total_trades":653,"aggressive_trade_rate":0.486983,"best_month":{"month_end":"2020-07-31 00:00:00+00:00","pnl":1415.365487,"ret":0.099333,"trades":12.0},"worst_month":{"month_end":"2025-01-31 00:00:00+00:00","pnl":-1073.53651,"ret":-0.050368,"trades":11.0},"best_day":{"date_utc":"2022-07-29 00:00:00+00:00","pnl":577.155167},"worst_day":{"date_utc":"2025-01-27 00:00:00+00:00","pnl":-786.304633},"cost_stress_tests":[{"cost_multiplier":1.25,"dual_perf":{"start_time_utc":"2017-12-01 00:00:00+00:00","end_time_utc":"2025-12-24 00:00:00+00:00","end_equity":20366.243056,"cagr":0.092225,"max_drawdown":0.08228,"calmar":1.120877,"n_days":2946},"avg_monthly_pnl":106.868485,"median_monthly_pnl":5.042517,"monthly_positive_rate":0.536082},{"cost_multiplier":1.5,"dual_perf":{"start_time_utc":"2017-12-01 00:00:00+00:00","end_time_utc":"2025-12-24 00:00:00+00:00","end_equity":18691.605641,"cagr":0.080664,"max_drawdown":0.089059,"calmar":0.905731,"n_days":2946},"avg_monthly_pnl":89.604182,"median_monthly_pnl":2.98336,"monthly_positive_rate":0.505155}],"bootstrap":{"enabled":true,"n_samples":800,"block_months":6,"seed":42,"avg_monthly_pnl":{"p05":50.026376,"p10":66.813192,"p50":121.866508,"p90":196.188685,"p95":214.310264,"mean":126.915189},"median_monthly_pnl":{"p05":0.0,"p10":0.0,"p50":38.839503,"p90":72.986005,"p95":81.757893,"mean":33.311231},"monthly_positive_rate":{"p05":0.443299,"p10":0.463918,"p50":0.536082,"p90":0.608247,"p95":0.628866,"mean":0.537165},"end_equity":{"p05":13837.594518,"p10":14933.422517,"p50":21610.017394,"p90":35125.299802,"p95":39391.719568,"mean":23766.288332},"max_drawdown":{"p05":0.053275,"p10":0.055732,"p50":0.078759,"p90":0.129157,"p95":0.146949,"mean":0.087595},"calmar":{"p05":0.331317,"p10":0.454653,"p50":1.251436,"p90":2.6984,"p95":3.351976,"mean":1.467759}}},"outputs":{"qqq_scored_events":"C:\\dev\\Coding\\Trading Bot\\adaptive-systematic-trading\\step3_out\\backtest\\qqq_scored_events.parquet","spy_scored_events":"C:\\dev\\Coding\\Trading Bot\\adaptive-systematic-trading\\step3_out\\backtest\\spy_scored_events.parquet","qqq_trades":"C:\\dev\\Coding\\Trading Bot\\adaptive-systematic-trading\\step3_out\\backtest\\qqq_trades.parquet","spy_trades":"C:\\dev\\Coding\\Trading Bot\\adaptive-systematic-trading\\step3_out\\backtest\\spy_trades.parquet","qqq_fold_summary":"C:\\dev\\Coding\\Trading Bot\\adaptive-systematic-trading\\step3_out\\backtest\\qqq_fold_summary.json","spy_fold_summary":"C:\\dev\\Coding\\Trading Bot\\adaptive-systematic-trading\\step3_out\\backtest\\spy_fold_summary.json","dual_plot":"C:\\dev\\Coding\\Trading Bot\\adaptive-systematic-trading\\step3_out\\backtest\\step3_dual_portfolio_curve.png"}}