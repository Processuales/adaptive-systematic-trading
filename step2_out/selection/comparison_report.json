{"meta":{"script":"step2_compare_and_select.py","script_version":"1.0.0","generated_utc":"2026-02-15T23:02:18.181638+00:00","n_scenarios":4,"n_trials_per_scenario":36,"seed":42,"filters_override":null},"scenario_summaries":[{"scenario":"qqq_cross_off","include_cross":false,"trade_symbol":"QQQ","cross_symbol":"SPY","meta":{"script_version":"1.0.0","generated_utc":"2026-02-15T22:59:14.867853+00:00","n_trials_requested":36,"n_trials_valid":24,"n_trials_ml_valid":18,"trade_symbol":"QQQ","symbols":["SPY","QQQ"],"cross_symbol":"SPY","include_cross":false,"split_policy":"80/20 chronological by bar index; train uses label_end_idx < split, test uses t_idx >= split"},"best_no_ml_test":{"n":34,"y_rate":0.441176,"net_bps_mean":12.111731,"net_bps_med":-9.279242,"cum_logret":0.04118,"end_equity":10420.39537,"max_drawdown":0.027421,"cagr":0.023926},"best_no_ml_filter":"no_overnight_sigma_50_85_trend_decile_4_6","best_ml_test":{"n":108,"y_rate":0.453704,"net_bps_mean":8.777201,"net_bps_med":-22.637418,"cum_logret":0.094794,"end_equity":10994.320983,"max_drawdown":0.053714,"cagr":0.049827},"best_ml_filter":"no_overnight"},{"scenario":"qqq_cross_on","include_cross":true,"trade_symbol":"QQQ","cross_symbol":"SPY","meta":{"script_version":"1.0.0","generated_utc":"2026-02-15T23:01:20.788837+00:00","n_trials_requested":36,"n_trials_valid":24,"n_trials_ml_valid":15,"trade_symbol":"QQQ","symbols":["SPY","QQQ"],"cross_symbol":"SPY","include_cross":true,"split_policy":"80/20 chronological by bar index; train uses label_end_idx < split, test uses t_idx >= split"},"best_no_ml_test":{"n":34,"y_rate":0.441176,"net_bps_mean":12.111731,"net_bps_med":-9.279242,"cum_logret":0.04118,"end_equity":10420.39537,"max_drawdown":0.027421,"cagr":0.023926},"best_no_ml_filter":"no_overnight_sigma_50_85_trend_decile_4_6","best_ml_test":{"n":127,"y_rate":0.535433,"net_bps_mean":9.314766,"net_bps_med":26.083432,"cum_logret":0.118298,"end_equity":11255.78958,"max_drawdown":0.065227,"cagr":0.061668},"best_ml_filter":"baseline"},{"scenario":"spy_cross_off","include_cross":false,"trade_symbol":"SPY","cross_symbol":"QQQ","meta":{"script_version":"1.0.0","generated_utc":"2026-02-15T23:01:49.826325+00:00","n_trials_requested":36,"n_trials_valid":24,"n_trials_ml_valid":15,"trade_symbol":"SPY","symbols":["SPY","QQQ"],"cross_symbol":"QQQ","include_cross":false,"split_policy":"80/20 chronological by bar index; train uses label_end_idx < split, test uses t_idx >= split"},"best_no_ml_test":{"n":33,"y_rate":0.515152,"net_bps_mean":11.33888,"net_bps_med":15.186738,"cum_logret":0.037418,"end_equity":10381.271831,"max_drawdown":0.027681,"cagr":0.019162},"best_no_ml_filter":"no_overnight_sigma_50_85_trend_0p3_1p0","best_ml_test":{"n":88,"y_rate":0.511364,"net_bps_mean":11.583122,"net_bps_med":7.14754,"cum_logret":0.101931,"end_equity":11073.075879,"max_drawdown":0.039673,"cagr":0.052463},"best_ml_filter":"no_overnight"},{"scenario":"spy_cross_on","include_cross":true,"trade_symbol":"SPY","cross_symbol":"QQQ","meta":{"script_version":"1.0.0","generated_utc":"2026-02-15T23:02:17.939406+00:00","n_trials_requested":36,"n_trials_valid":24,"n_trials_ml_valid":12,"trade_symbol":"SPY","symbols":["SPY","QQQ"],"cross_symbol":"QQQ","include_cross":true,"split_policy":"80/20 chronological by bar index; train uses label_end_idx < split, test uses t_idx >= split"},"best_no_ml_test":{"n":33,"y_rate":0.515152,"net_bps_mean":11.33888,"net_bps_med":15.186738,"cum_logret":0.037418,"end_equity":10381.271831,"max_drawdown":0.027681,"cagr":0.019162},"best_no_ml_filter":"no_overnight_sigma_50_85_trend_0p3_1p0","best_ml_test":{"n":49,"y_rate":0.530612,"net_bps_mean":7.737034,"net_bps_med":20.173259,"cum_logret":0.037911,"end_equity":10386.392725,"max_drawdown":0.031486,"cagr":0.019018},"best_ml_filter":"no_overnight_sigma_55_90"}],"best_candidates":{"non_ml_by_end_equity":{"mode":"no_ml","selected_by":"end_equity","scenario":{"name":"qqq_cross_off","symbols":["SPY","QQQ"],"trade_symbol":"QQQ","cross_symbol":"SPY","include_cross":false},"summary_path":"C:\\dev\\Coding\\Trading Bot\\adaptive-systematic-trading\\step2_out\\selection\\qqq_cross_off\\step2b_summary.json","trial":{"filter_name":"no_overnight_sigma_50_85_trend_decile_4_6","knobs":{"trend_fast_span":8,"trend_slow_span":40,"trend_in":1.105922,"pullback_z":0.876791,"trend_regime_min":0.289646,"min_event_spacing_bars":1,"ewma_var_alpha":0.086644,"atr_span":14,"horizon_intra":16,"horizon_overn":10,"tp_mult_intra":1.801457,"sl_mult_intra":1.013936,"tp_mult_overn":1.916285,"sl_mult_overn":1.066665,"same_bar_policy":"worst","spread_half_bps":{"SPY":0.8,"QQQ":1.2,"SMH":1.8},"slip_base_bps":0.8,"slip_vol_mult":0.05,"slip_spike_add_bps":2.0,"vol_spike_q":0.9,"overnight_slip_add_bps":1.5,"commission_round_trip_bps":1.0,"gap_lookback_events":120,"gap_tail_k":2.0,"sigma_rank_window":500,"atr_rank_window":500,"rank_min_periods":200,"intraday_tail_window":200,"intraday_tail_min_periods":50,"intraday_tail_z":2.0,"include_cross_asset":false,"cross_symbol":"SPY","cross_merge_tolerance":"30min","dropna_core_only":true},"n_bars":17626,"split_bar_idx":14100,"split_time_utc":"2024-02-06 19:00:00+00:00","base_counts":{"all_events":8568,"filtered_events":507,"train_filtered":397,"test_filtered":110},"no_ml":{"train":{"n":113,"y_rate":0.575221,"net_bps_mean":12.951226,"net_bps_med":29.842565,"cum_logret":0.146349,"end_equity":11575.999537,"max_drawdown":0.049595,"cagr":0.01919},"test":{"n":34,"y_rate":0.441176,"net_bps_mean":12.111731,"net_bps_med":-9.279242,"cum_logret":0.04118,"end_equity":10420.39537,"max_drawdown":0.027421,"cagr":0.023926},"score":10101.075962},"ml_sim":{"model_features":["trend_score","pullback_z","sigma","u_atr","sigma_prank","u_atr_prank","gap_sd","gap_tail","vol_z","dist_to_hi","range_ratio","tp_to_cost","entry_overnight"],"p_cut":0.573086,"edge_cut":0.002202,"p_quantile":0.65,"edge_quantile":0.6,"threshold_tune_score":417.866046,"target_keep_train":80,"ret_mix_weight":0.35,"valid":false,"train":{"n":0,"y_rate":null,"net_bps_mean":null,"net_bps_med":null,"cum_logret":null,"end_equity":10000.0,"max_drawdown":null,"cagr":null},"test":{"n":0,"y_rate":null,"net_bps_mean":null,"net_bps_med":null,"cum_logret":null,"end_equity":10000.0,"max_drawdown":null,"cagr":null},"score":-1e+18},"trial":18},"test_snapshot":{"n":34,"end_equity":10420.39537,"cagr":0.023926,"max_drawdown":0.027421,"calmar":0.872543,"net_bps_mean":12.111731}},"non_ml_by_calmar":{"mode":"no_ml","selected_by":"end_equity","scenario":{"name":"qqq_cross_off","symbols":["SPY","QQQ"],"trade_symbol":"QQQ","cross_symbol":"SPY","include_cross":false},"summary_path":"C:\\dev\\Coding\\Trading Bot\\adaptive-systematic-trading\\step2_out\\selection\\qqq_cross_off\\step2b_summary.json","trial":{"filter_name":"no_overnight_sigma_50_85_trend_decile_4_6","knobs":{"trend_fast_span":8,"trend_slow_span":40,"trend_in":1.105922,"pullback_z":0.876791,"trend_regime_min":0.289646,"min_event_spacing_bars":1,"ewma_var_alpha":0.086644,"atr_span":14,"horizon_intra":16,"horizon_overn":10,"tp_mult_intra":1.801457,"sl_mult_intra":1.013936,"tp_mult_overn":1.916285,"sl_mult_overn":1.066665,"same_bar_policy":"worst","spread_half_bps":{"SPY":0.8,"QQQ":1.2,"SMH":1.8},"slip_base_bps":0.8,"slip_vol_mult":0.05,"slip_spike_add_bps":2.0,"vol_spike_q":0.9,"overnight_slip_add_bps":1.5,"commission_round_trip_bps":1.0,"gap_lookback_events":120,"gap_tail_k":2.0,"sigma_rank_window":500,"atr_rank_window":500,"rank_min_periods":200,"intraday_tail_window":200,"intraday_tail_min_periods":50,"intraday_tail_z":2.0,"include_cross_asset":false,"cross_symbol":"SPY","cross_merge_tolerance":"30min","dropna_core_only":true},"n_bars":17626,"split_bar_idx":14100,"split_time_utc":"2024-02-06 19:00:00+00:00","base_counts":{"all_events":8568,"filtered_events":507,"train_filtered":397,"test_filtered":110},"no_ml":{"train":{"n":113,"y_rate":0.575221,"net_bps_mean":12.951226,"net_bps_med":29.842565,"cum_logret":0.146349,"end_equity":11575.999537,"max_drawdown":0.049595,"cagr":0.01919},"test":{"n":34,"y_rate":0.441176,"net_bps_mean":12.111731,"net_bps_med":-9.279242,"cum_logret":0.04118,"end_equity":10420.39537,"max_drawdown":0.027421,"cagr":0.023926},"score":10101.075962},"ml_sim":{"model_features":["trend_score","pullback_z","sigma","u_atr","sigma_prank","u_atr_prank","gap_sd","gap_tail","vol_z","dist_to_hi","range_ratio","tp_to_cost","entry_overnight"],"p_cut":0.573086,"edge_cut":0.002202,"p_quantile":0.65,"edge_quantile":0.6,"threshold_tune_score":417.866046,"target_keep_train":80,"ret_mix_weight":0.35,"valid":false,"train":{"n":0,"y_rate":null,"net_bps_mean":null,"net_bps_med":null,"cum_logret":null,"end_equity":10000.0,"max_drawdown":null,"cagr":null},"test":{"n":0,"y_rate":null,"net_bps_mean":null,"net_bps_med":null,"cum_logret":null,"end_equity":10000.0,"max_drawdown":null,"cagr":null},"score":-1e+18},"trial":18},"test_snapshot":{"n":34,"end_equity":10420.39537,"cagr":0.023926,"max_drawdown":0.027421,"calmar":0.872543,"net_bps_mean":12.111731}},"ml_by_end_equity":{"mode":"ml_sim","selected_by":"end_equity","scenario":{"name":"qqq_cross_on","symbols":["SPY","QQQ"],"trade_symbol":"QQQ","cross_symbol":"SPY","include_cross":true},"summary_path":"C:\\dev\\Coding\\Trading Bot\\adaptive-systematic-trading\\step2_out\\selection\\qqq_cross_on\\step2b_summary.json","trial":{"filter_name":"baseline","knobs":{"trend_fast_span":16,"trend_slow_span":40,"trend_in":0.828395,"pullback_z":1.487504,"trend_regime_min":0.533009,"min_event_spacing_bars":1,"ewma_var_alpha":0.05089,"atr_span":10,"horizon_intra":16,"horizon_overn":8,"tp_mult_intra":1.949143,"sl_mult_intra":1.571233,"tp_mult_overn":2.157274,"sl_mult_overn":1.590934,"same_bar_policy":"worst","spread_half_bps":{"SPY":0.8,"QQQ":1.2,"SMH":1.8},"slip_base_bps":0.8,"slip_vol_mult":0.05,"slip_spike_add_bps":2.0,"vol_spike_q":0.9,"overnight_slip_add_bps":1.5,"commission_round_trip_bps":1.0,"gap_lookback_events":120,"gap_tail_k":2.0,"sigma_rank_window":500,"atr_rank_window":500,"rank_min_periods":200,"intraday_tail_window":200,"intraday_tail_min_periods":50,"intraday_tail_z":2.0,"include_cross_asset":true,"cross_symbol":"SPY","cross_merge_tolerance":"30min","dropna_core_only":true},"n_bars":17626,"split_bar_idx":14100,"split_time_utc":"2024-02-06 19:00:00+00:00","base_counts":{"all_events":8066,"filtered_events":8066,"train_filtered":6503,"test_filtered":1557},"no_ml":{"train":{"n":759,"y_rate":0.516469,"net_bps_mean":-1.350948,"net_bps_med":14.344868,"cum_logret":-0.102537,"end_equity":9025.447906,"max_drawdown":0.257688,"cagr":-0.012687},"test":{"n":169,"y_rate":0.497041,"net_bps_mean":-0.527371,"net_bps_med":-5.494612,"cum_logret":-0.008913,"end_equity":9911.270285,"max_drawdown":0.128061,"cagr":-0.004499},"score":8609.078468},"ml_sim":{"model_features":["trend_score","pullback_z","sigma","u_atr","sigma_prank","u_atr_prank","gap_sd","gap_tail","vol_z","dist_to_hi","range_ratio","tp_to_cost","ret_spread","beta_proxy","entry_overnight"],"p_cut":0.561263,"edge_cut":0.000524,"p_quantile":0.45,"edge_quantile":0.5,"threshold_tune_score":-109.513825,"target_keep_train":80,"ret_mix_weight":0.35,"valid":true,"train":{"n":413,"y_rate":0.561743,"net_bps_mean":8.382295,"net_bps_med":32.830992,"cum_logret":0.346189,"end_equity":14136.694523,"max_drawdown":0.134622,"cagr":0.044502},"test":{"n":127,"y_rate":0.535433,"net_bps_mean":9.314766,"net_bps_med":26.083432,"cum_logret":0.118298,"end_equity":11255.78958,"max_drawdown":0.065227,"cagr":0.061668},"score":10484.314857},"trial":25},"test_snapshot":{"n":127,"end_equity":11255.78958,"cagr":0.061668,"max_drawdown":0.065227,"calmar":0.945437,"net_bps_mean":9.314766}},"ml_by_calmar":{"mode":"ml_sim","selected_by":"end_equity","scenario":{"name":"spy_cross_off","symbols":["SPY","QQQ"],"trade_symbol":"SPY","cross_symbol":"QQQ","include_cross":false},"summary_path":"C:\\dev\\Coding\\Trading Bot\\adaptive-systematic-trading\\step2_out\\selection\\spy_cross_off\\step2b_summary.json","trial":{"filter_name":"no_overnight","knobs":{"trend_fast_span":16,"trend_slow_span":64,"trend_in":0.910785,"pullback_z":0.785586,"trend_regime_min":0.476572,"min_event_spacing_bars":1,"ewma_var_alpha":0.04507,"atr_span":18,"horizon_intra":16,"horizon_overn":12,"tp_mult_intra":2.942432,"sl_mult_intra":1.800884,"tp_mult_overn":3.239273,"sl_mult_overn":2.113934,"same_bar_policy":"worst","spread_half_bps":{"SPY":0.8,"QQQ":1.2,"SMH":1.8},"slip_base_bps":0.8,"slip_vol_mult":0.05,"slip_spike_add_bps":2.0,"vol_spike_q":0.9,"overnight_slip_add_bps":1.5,"commission_round_trip_bps":1.0,"gap_lookback_events":120,"gap_tail_k":2.0,"sigma_rank_window":500,"atr_rank_window":500,"rank_min_periods":200,"intraday_tail_window":200,"intraday_tail_min_periods":50,"intraday_tail_z":2.0,"include_cross_asset":false,"cross_symbol":"QQQ","cross_merge_tolerance":"30min","dropna_core_only":true},"n_bars":17654,"split_bar_idx":14123,"split_time_utc":"2024-02-06 14:30:00+00:00","base_counts":{"all_events":9922,"filtered_events":8494,"train_filtered":6734,"test_filtered":1751},"no_ml":{"train":{"n":703,"y_rate":0.495021,"net_bps_mean":-1.115242,"net_bps_med":-0.894007,"cum_logret":-0.078402,"end_equity":9245.930858,"max_drawdown":0.199392,"cagr":-0.009719},"test":{"n":183,"y_rate":0.491803,"net_bps_mean":5.836576,"net_bps_med":-3.958583,"cum_logret":0.106809,"end_equity":11127.22093,"max_drawdown":0.088575,"cagr":0.054432},"score":9863.554469},"ml_sim":{"model_features":["trend_score","pullback_z","sigma","u_atr","sigma_prank","u_atr_prank","gap_sd","gap_tail","vol_z","dist_to_hi","range_ratio","tp_to_cost","entry_overnight"],"p_cut":0.560604,"edge_cut":0.001382,"p_quantile":0.65,"edge_quantile":0.6,"threshold_tune_score":0.360953,"target_keep_train":80,"ret_mix_weight":0.35,"valid":true,"train":{"n":217,"y_rate":0.557604,"net_bps_mean":8.033159,"net_bps_med":17.815751,"cum_logret":0.17432,"end_equity":11904.358966,"max_drawdown":0.083749,"cagr":0.022536},"test":{"n":88,"y_rate":0.511364,"net_bps_mean":11.583122,"net_bps_med":7.14754,"cum_logret":0.101931,"end_equity":11073.075879,"max_drawdown":0.039673,"cagr":0.052463},"score":10491.771749},"trial":30},"test_snapshot":{"n":88,"end_equity":11073.075879,"cagr":0.052463,"max_drawdown":0.039673,"calmar":1.322386,"net_bps_mean":11.583122}}}}