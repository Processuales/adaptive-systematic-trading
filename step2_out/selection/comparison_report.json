{"meta":{"script":"step2_compare_and_select.py","script_version":"1.0.0","generated_utc":"2026-02-16T01:45:47.190183+00:00","n_scenarios":4,"n_trials_per_scenario":20,"seed":42,"filters_override":null},"scenario_summaries":[{"scenario":"qqq_cross_off","include_cross":false,"trade_symbol":"QQQ","cross_symbol":"SPY","meta":{"script_version":"1.0.0","generated_utc":"2026-02-16T01:44:58.411789+00:00","n_trials_requested":20,"n_trials_valid":14,"n_trials_ml_valid":9,"trade_symbol":"QQQ","symbols":["SPY","QQQ"],"cross_symbol":"SPY","include_cross":false,"split_policy":"80/20 chronological by bar index; train uses label_end_idx < split, test uses t_idx >= split"},"best_no_ml_test":{"n":34,"y_rate":0.441176,"net_bps_mean":12.111731,"net_bps_med":-9.279242,"cum_logret":0.04118,"end_equity":10420.39537,"max_drawdown":0.027421,"cagr":0.023926},"best_no_ml_filter":"no_overnight_sigma_50_85_trend_decile_4_6","best_ml_test":{"n":108,"y_rate":0.453704,"net_bps_mean":8.777201,"net_bps_med":-22.637418,"cum_logret":0.094794,"end_equity":10994.320983,"max_drawdown":0.053714,"cagr":0.049827},"best_ml_filter":"no_overnight"},{"scenario":"qqq_cross_on","include_cross":true,"trade_symbol":"QQQ","cross_symbol":"SPY","meta":{"script_version":"1.0.0","generated_utc":"2026-02-16T01:45:14.297333+00:00","n_trials_requested":20,"n_trials_valid":14,"n_trials_ml_valid":7,"trade_symbol":"QQQ","symbols":["SPY","QQQ"],"cross_symbol":"SPY","include_cross":true,"split_policy":"80/20 chronological by bar index; train uses label_end_idx < split, test uses t_idx >= split"},"best_no_ml_test":{"n":34,"y_rate":0.441176,"net_bps_mean":12.111731,"net_bps_med":-9.279242,"cum_logret":0.04118,"end_equity":10420.39537,"max_drawdown":0.027421,"cagr":0.023926},"best_no_ml_filter":"no_overnight_sigma_50_85_trend_decile_4_6","best_ml_test":{"n":96,"y_rate":0.4375,"net_bps_mean":3.715856,"net_bps_med":-32.092474,"cum_logret":0.035672,"end_equity":10363.161082,"max_drawdown":0.0702,"cagr":0.018467},"best_ml_filter":"no_overnight"},{"scenario":"spy_cross_off","include_cross":false,"trade_symbol":"SPY","cross_symbol":"QQQ","meta":{"script_version":"1.0.0","generated_utc":"2026-02-16T01:45:30.470106+00:00","n_trials_requested":20,"n_trials_valid":13,"n_trials_ml_valid":7,"trade_symbol":"SPY","symbols":["SPY","QQQ"],"cross_symbol":"QQQ","include_cross":false,"split_policy":"80/20 chronological by bar index; train uses label_end_idx < split, test uses t_idx >= split"},"best_no_ml_test":{"n":33,"y_rate":0.515152,"net_bps_mean":11.33888,"net_bps_med":15.186738,"cum_logret":0.037418,"end_equity":10381.271831,"max_drawdown":0.027681,"cagr":0.019162},"best_no_ml_filter":"no_overnight_sigma_50_85_trend_0p3_1p0","best_ml_test":{"n":37,"y_rate":0.567568,"net_bps_mean":22.009306,"net_bps_med":9.482366,"cum_logret":0.081434,"end_equity":10848.420844,"max_drawdown":0.02952,"cagr":0.042176},"best_ml_filter":"no_overnight_sigma_50_85"},{"scenario":"spy_cross_on","include_cross":true,"trade_symbol":"SPY","cross_symbol":"QQQ","meta":{"script_version":"1.0.0","generated_utc":"2026-02-16T01:45:46.875560+00:00","n_trials_requested":20,"n_trials_valid":13,"n_trials_ml_valid":6,"trade_symbol":"SPY","symbols":["SPY","QQQ"],"cross_symbol":"QQQ","include_cross":true,"split_policy":"80/20 chronological by bar index; train uses label_end_idx < split, test uses t_idx >= split"},"best_no_ml_test":{"n":33,"y_rate":0.515152,"net_bps_mean":11.33888,"net_bps_med":15.186738,"cum_logret":0.037418,"end_equity":10381.271831,"max_drawdown":0.027681,"cagr":0.019162},"best_no_ml_filter":"no_overnight_sigma_50_85_trend_0p3_1p0","best_ml_test":{"n":41,"y_rate":0.512195,"net_bps_mean":9.507294,"net_bps_med":3.642028,"cum_logret":0.03898,"end_equity":10397.495897,"max_drawdown":0.04411,"cagr":0.019914},"best_ml_filter":"no_overnight_sigma_50_85"}],"best_candidates":{"non_ml_by_end_equity":{"mode":"no_ml","selected_by":"end_equity","scenario":{"name":"qqq_cross_off","symbols":["SPY","QQQ"],"trade_symbol":"QQQ","cross_symbol":"SPY","include_cross":false},"summary_path":"C:\\dev\\Coding\\Trading Bot\\adaptive-systematic-trading\\step2_out\\selection\\qqq_cross_off\\step2b_summary.json","trial":{"filter_name":"no_overnight_sigma_50_85_trend_decile_4_6","knobs":{"trend_fast_span":8,"trend_slow_span":40,"trend_in":1.105922,"pullback_z":0.876791,"trend_regime_min":0.289646,"min_event_spacing_bars":1,"ewma_var_alpha":0.086644,"atr_span":14,"horizon_intra":16,"horizon_overn":10,"tp_mult_intra":1.801457,"sl_mult_intra":1.013936,"tp_mult_overn":1.916285,"sl_mult_overn":1.066665,"same_bar_policy":"worst","spread_half_bps":{"SPY":0.8,"QQQ":1.2,"SMH":1.8},"slip_base_bps":0.8,"slip_vol_mult":0.05,"slip_spike_add_bps":2.0,"vol_spike_q":0.9,"overnight_slip_add_bps":1.5,"commission_round_trip_bps":1.0,"gap_lookback_events":120,"gap_tail_k":2.0,"sigma_rank_window":500,"atr_rank_window":500,"rank_min_periods":200,"intraday_tail_window":200,"intraday_tail_min_periods":50,"intraday_tail_z":2.0,"include_cross_asset":false,"cross_symbol":"SPY","cross_merge_tolerance":"30min","dropna_core_only":true},"n_bars":17626,"split_bar_idx":14100,"split_time_utc":"2024-02-06 19:00:00+00:00","base_counts":{"all_events":8568,"filtered_events":507,"train_filtered":397,"test_filtered":110},"no_ml":{"train":{"n":113,"y_rate":0.575221,"net_bps_mean":12.951226,"net_bps_med":29.842565,"cum_logret":0.146349,"end_equity":11575.999537,"max_drawdown":0.049595,"cagr":0.01919},"test":{"n":34,"y_rate":0.441176,"net_bps_mean":12.111731,"net_bps_med":-9.279242,"cum_logret":0.04118,"end_equity":10420.39537,"max_drawdown":0.027421,"cagr":0.023926},"score":10101.075962},"ml_sim":{"model_features":["trend_score","pullback_z","sigma","u_atr","sigma_prank","u_atr_prank","gap_sd","gap_tail","vol_z","dist_to_hi","range_ratio","tp_to_cost","entry_overnight"],"p_cut":0.573086,"edge_cut":0.002202,"p_quantile":0.65,"edge_quantile":0.6,"threshold_tune_score":417.866046,"target_keep_train":80,"ret_mix_weight":0.35,"valid":false,"train":{"n":0,"y_rate":null,"net_bps_mean":null,"net_bps_med":null,"cum_logret":null,"end_equity":10000.0,"max_drawdown":null,"cagr":null},"test":{"n":0,"y_rate":null,"net_bps_mean":null,"net_bps_med":null,"cum_logret":null,"end_equity":10000.0,"max_drawdown":null,"cagr":null},"score":-1e+18},"trial":18},"test_snapshot":{"n":34,"end_equity":10420.39537,"cagr":0.023926,"max_drawdown":0.027421,"calmar":0.872543,"net_bps_mean":12.111731}},"non_ml_by_calmar":{"mode":"no_ml","selected_by":"end_equity","scenario":{"name":"qqq_cross_off","symbols":["SPY","QQQ"],"trade_symbol":"QQQ","cross_symbol":"SPY","include_cross":false},"summary_path":"C:\\dev\\Coding\\Trading Bot\\adaptive-systematic-trading\\step2_out\\selection\\qqq_cross_off\\step2b_summary.json","trial":{"filter_name":"no_overnight_sigma_50_85_trend_decile_4_6","knobs":{"trend_fast_span":8,"trend_slow_span":40,"trend_in":1.105922,"pullback_z":0.876791,"trend_regime_min":0.289646,"min_event_spacing_bars":1,"ewma_var_alpha":0.086644,"atr_span":14,"horizon_intra":16,"horizon_overn":10,"tp_mult_intra":1.801457,"sl_mult_intra":1.013936,"tp_mult_overn":1.916285,"sl_mult_overn":1.066665,"same_bar_policy":"worst","spread_half_bps":{"SPY":0.8,"QQQ":1.2,"SMH":1.8},"slip_base_bps":0.8,"slip_vol_mult":0.05,"slip_spike_add_bps":2.0,"vol_spike_q":0.9,"overnight_slip_add_bps":1.5,"commission_round_trip_bps":1.0,"gap_lookback_events":120,"gap_tail_k":2.0,"sigma_rank_window":500,"atr_rank_window":500,"rank_min_periods":200,"intraday_tail_window":200,"intraday_tail_min_periods":50,"intraday_tail_z":2.0,"include_cross_asset":false,"cross_symbol":"SPY","cross_merge_tolerance":"30min","dropna_core_only":true},"n_bars":17626,"split_bar_idx":14100,"split_time_utc":"2024-02-06 19:00:00+00:00","base_counts":{"all_events":8568,"filtered_events":507,"train_filtered":397,"test_filtered":110},"no_ml":{"train":{"n":113,"y_rate":0.575221,"net_bps_mean":12.951226,"net_bps_med":29.842565,"cum_logret":0.146349,"end_equity":11575.999537,"max_drawdown":0.049595,"cagr":0.01919},"test":{"n":34,"y_rate":0.441176,"net_bps_mean":12.111731,"net_bps_med":-9.279242,"cum_logret":0.04118,"end_equity":10420.39537,"max_drawdown":0.027421,"cagr":0.023926},"score":10101.075962},"ml_sim":{"model_features":["trend_score","pullback_z","sigma","u_atr","sigma_prank","u_atr_prank","gap_sd","gap_tail","vol_z","dist_to_hi","range_ratio","tp_to_cost","entry_overnight"],"p_cut":0.573086,"edge_cut":0.002202,"p_quantile":0.65,"edge_quantile":0.6,"threshold_tune_score":417.866046,"target_keep_train":80,"ret_mix_weight":0.35,"valid":false,"train":{"n":0,"y_rate":null,"net_bps_mean":null,"net_bps_med":null,"cum_logret":null,"end_equity":10000.0,"max_drawdown":null,"cagr":null},"test":{"n":0,"y_rate":null,"net_bps_mean":null,"net_bps_med":null,"cum_logret":null,"end_equity":10000.0,"max_drawdown":null,"cagr":null},"score":-1e+18},"trial":18},"test_snapshot":{"n":34,"end_equity":10420.39537,"cagr":0.023926,"max_drawdown":0.027421,"calmar":0.872543,"net_bps_mean":12.111731}},"ml_by_end_equity":{"mode":"ml_sim","selected_by":"end_equity","scenario":{"name":"qqq_cross_off","symbols":["SPY","QQQ"],"trade_symbol":"QQQ","cross_symbol":"SPY","include_cross":false},"summary_path":"C:\\dev\\Coding\\Trading Bot\\adaptive-systematic-trading\\step2_out\\selection\\qqq_cross_off\\step2b_summary.json","trial":{"filter_name":"no_overnight","knobs":{"trend_fast_span":8,"trend_slow_span":56,"trend_in":0.779159,"pullback_z":1.472738,"trend_regime_min":0.463816,"min_event_spacing_bars":1,"ewma_var_alpha":0.098537,"atr_span":10,"horizon_intra":14,"horizon_overn":14,"tp_mult_intra":2.70049,"sl_mult_intra":1.128114,"tp_mult_overn":2.925683,"sl_mult_overn":1.276433,"same_bar_policy":"worst","spread_half_bps":{"SPY":0.8,"QQQ":1.2,"SMH":1.8},"slip_base_bps":0.8,"slip_vol_mult":0.05,"slip_spike_add_bps":2.0,"vol_spike_q":0.9,"overnight_slip_add_bps":1.5,"commission_round_trip_bps":1.0,"gap_lookback_events":120,"gap_tail_k":2.0,"sigma_rank_window":500,"atr_rank_window":500,"rank_min_periods":200,"intraday_tail_window":200,"intraday_tail_min_periods":50,"intraday_tail_z":2.0,"include_cross_asset":false,"cross_symbol":"SPY","cross_merge_tolerance":"30min","dropna_core_only":true},"n_bars":17626,"split_bar_idx":14100,"split_time_utc":"2024-02-06 19:00:00+00:00","base_counts":{"all_events":10062,"filtered_events":8611,"train_filtered":6914,"test_filtered":1691},"no_ml":{"train":{"n":913,"y_rate":0.41402,"net_bps_mean":0.258891,"net_bps_med":-26.457385,"cum_logret":0.023637,"end_equity":10239.182688,"max_drawdown":0.265528,"cagr":0.002947},"test":{"n":217,"y_rate":0.396313,"net_bps_mean":-4.87345,"net_bps_med":-31.84647,"cum_logret":-0.105754,"end_equity":8996.460552,"max_drawdown":0.162594,"cagr":-0.051808},"score":7328.398739},"ml_sim":{"model_features":["trend_score","pullback_z","sigma","u_atr","sigma_prank","u_atr_prank","gap_sd","gap_tail","vol_z","dist_to_hi","range_ratio","tp_to_cost","entry_overnight"],"p_cut":0.552617,"edge_cut":0.002369,"p_quantile":0.65,"edge_quantile":0.6,"threshold_tune_score":-58.190823,"target_keep_train":80,"ret_mix_weight":0.35,"valid":true,"train":{"n":276,"y_rate":0.442029,"net_bps_mean":6.655081,"net_bps_med":-23.644244,"cum_logret":0.18368,"end_equity":12016.315361,"max_drawdown":0.119533,"cagr":0.023371},"test":{"n":108,"y_rate":0.453704,"net_bps_mean":8.777201,"net_bps_med":-22.637418,"cum_logret":0.094794,"end_equity":10994.320983,"max_drawdown":0.053714,"cagr":0.049827},"score":10318.889622},"trial":1},"test_snapshot":{"n":108,"end_equity":10994.320983,"cagr":0.049827,"max_drawdown":0.053714,"calmar":0.927635,"net_bps_mean":8.777201}},"ml_by_calmar":{"mode":"ml_sim","selected_by":"end_equity","scenario":{"name":"spy_cross_off","symbols":["SPY","QQQ"],"trade_symbol":"SPY","cross_symbol":"QQQ","include_cross":false},"summary_path":"C:\\dev\\Coding\\Trading Bot\\adaptive-systematic-trading\\step2_out\\selection\\spy_cross_off\\step2b_summary.json","trial":{"filter_name":"no_overnight_sigma_50_85","knobs":{"trend_fast_span":10,"trend_slow_span":56,"trend_in":0.527552,"pullback_z":1.22888,"trend_regime_min":0.226767,"min_event_spacing_bars":1,"ewma_var_alpha":0.095507,"atr_span":24,"horizon_intra":12,"horizon_overn":10,"tp_mult_intra":2.427282,"sl_mult_intra":1.022804,"tp_mult_overn":2.906561,"sl_mult_overn":1.215725,"same_bar_policy":"worst","spread_half_bps":{"SPY":0.8,"QQQ":1.2,"SMH":1.8},"slip_base_bps":0.8,"slip_vol_mult":0.05,"slip_spike_add_bps":2.0,"vol_spike_q":0.9,"overnight_slip_add_bps":1.5,"commission_round_trip_bps":1.0,"gap_lookback_events":120,"gap_tail_k":2.0,"sigma_rank_window":500,"atr_rank_window":500,"rank_min_periods":200,"intraday_tail_window":200,"intraday_tail_min_periods":50,"intraday_tail_z":2.0,"include_cross_asset":false,"cross_symbol":"QQQ","cross_merge_tolerance":"30min","dropna_core_only":true},"n_bars":17654,"split_bar_idx":14123,"split_time_utc":"2024-02-06 14:30:00+00:00","base_counts":{"all_events":10630,"filtered_events":2146,"train_filtered":1650,"test_filtered":491},"no_ml":{"train":{"n":365,"y_rate":0.389041,"net_bps_mean":-5.124078,"net_bps_med":-22.64781,"cum_logret":-0.187029,"end_equity":8294.198105,"max_drawdown":0.187792,"cagr":-0.023377},"test":{"n":105,"y_rate":0.380952,"net_bps_mean":-3.272604,"net_bps_med":-29.860897,"cum_logret":-0.034362,"end_equity":9662.213431,"max_drawdown":0.077923,"cagr":-0.016907},"score":8835.248673},"ml_sim":{"model_features":["trend_score","pullback_z","sigma","u_atr","sigma_prank","u_atr_prank","gap_sd","gap_tail","vol_z","dist_to_hi","range_ratio","tp_to_cost","entry_overnight"],"p_cut":0.552409,"edge_cut":0.001895,"p_quantile":0.6,"edge_quantile":0.6,"threshold_tune_score":137.492983,"target_keep_train":80,"ret_mix_weight":0.35,"valid":true,"train":{"n":62,"y_rate":0.451613,"net_bps_mean":19.81521,"net_bps_med":-13.018177,"cum_logret":0.122854,"end_equity":11307.196652,"max_drawdown":0.041321,"cagr":0.019537},"test":{"n":37,"y_rate":0.567568,"net_bps_mean":22.009306,"net_bps_med":9.482366,"cum_logret":0.081434,"end_equity":10848.420844,"max_drawdown":0.02952,"cagr":0.042176},"score":10440.414827},"trial":12},"test_snapshot":{"n":37,"end_equity":10848.420844,"cagr":0.042176,"max_drawdown":0.02952,"calmar":1.428726,"net_bps_mean":22.009306}}}}